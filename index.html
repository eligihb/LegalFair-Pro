<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
Â  <meta charset="UTF-8">
Â  <title>×¨×™×©×•× ××ª×¢× ×™×™× ×™× â€“ ×™×¨×™×“ ××ª××—×™×</title>
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">

Â  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700&display=swap" rel="stylesheet">

Â  <style>
Â  Â  *{box-sizing:border-box;}

Â  Â  body{
Â  Â  Â  margin:0;
Â  Â  Â  padding:10px;
Â  Â  Â  font-family:'Heebo',system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
Â  Â  Â  background:#f3f4f6;
Â  Â  Â  color:#111827;
Â  Â  }

Â  Â  .shell{
Â  Â  Â  max-width:480px;
Â  Â  Â  margin:0 auto;
Â  Â  }

Â  Â  .top-bar{
Â  Â  Â  display:flex;
Â  Â  Â  gap:6px;
Â  Â  Â  margin-bottom:8px;
Â  Â  Â  flex-wrap:wrap;
Â  Â  Â  justify-content:space-between;
Â  Â  }

Â  Â  .top-btn{
Â  Â  Â  flex:1 1 0;
Â  Â  Â  border-radius:999px;
Â  Â  Â  border:1px solid #d1d5db;
Â  Â  Â  padding:6px 10px;
Â  Â  Â  font-size:.8rem;
Â  Â  Â  font-weight:600;
Â  Â  Â  background:#ffffff;
Â  Â  Â  cursor:pointer;
Â  Â  Â  text-align:center;
Â  Â  Â  white-space:nowrap;
Â  Â  }
Â  Â  .top-btn.main{
Â  Â  Â  background:#0f766e;
Â  Â  Â  color:#fff;
Â  Â  Â  border-color:#0f766e;
Â  Â  }

Â  Â  .card{
Â  Â  Â  background:#ffffff;
Â  Â  Â  border-radius:16px;
Â  Â  Â  box-shadow:0 6px 18px rgba(15,23,42,.12);
Â  Â  Â  padding:14px 12px 16px;
Â  Â  }

Â  Â  h1{
Â  Â  Â  margin:0 0 4px;
Â  Â  Â  font-size:1.35rem;
Â  Â  Â  text-align:center;
Â  Â  Â  color:#0f766e;
Â  Â  }

Â  Â  .subtitle{
Â  Â  Â  text-align:center;
Â  Â  Â  font-size:.85rem;
Â  Â  Â  color:#6b7280;
Â  Â  Â  margin-bottom:8px;
Â  Â  }

Â  Â  .section-title{
Â  Â  Â  margin:10px 0 4px;
Â  Â  Â  font-size:.9rem;
Â  Â  Â  font-weight:700;
Â  Â  Â  color:#0f766e;
Â  Â  Â  border-bottom:1px solid #e5e7eb;
Â  Â  Â  padding-bottom:3px;
Â  Â  }

Â  Â  .grid{display:grid;gap:6px;}
Â  Â  .grid-2{grid-template-columns: minmax(0,1.05fr) minmax(0,.95fr);}
Â  Â  @media(max-width:600px){.grid-2{grid-template-columns:1fr;}}

Â  Â  label{
Â  Â  Â  display:block;
Â  Â  Â  font-size:.82rem;
Â  Â  Â  font-weight:600;
Â  Â  Â  color:#374151;
Â  Â  Â  margin-bottom:2px;
Â  Â  }
Â  Â  .req::after{
Â  Â  Â  content:" *";
Â  Â  Â  color:#b91c1c;
Â  Â  Â  font-weight:700;
Â  Â  }

Â  Â  input,select,textarea{
Â  Â  Â  width:100%;
Â  Â  Â  border-radius:10px;
Â  Â  Â  border:1px solid #d1d5db;
Â  Â  Â  padding:7px 8px;
Â  Â  Â  font-size:.9rem;
Â  Â  Â  background:#f9fafb;
Â  Â  Â  transition:border-color .15s,box-shadow .15s,background .15s;
Â  Â  }
Â  Â  input:focus,select:focus,textarea:focus{
Â  Â  Â  outline:none;
Â  Â  Â  border-color:#0f766e;
Â  Â  Â  box-shadow:0 0 0 2px rgba(16,185,129,.25);
Â  Â  Â  background:#fff;
Â  Â  }
Â  Â  textarea{resize:vertical;min-height:70px;}

Â  Â  .short{max-width:220px;}
Â  Â  .short-inline{max-width:200px;}

Â  Â  .hint{
Â  Â  Â  font-size:.75rem;
Â  Â  Â  color:#9ca3af;
Â  Â  Â  margin-top:1px;
Â  Â  }

Â  Â  .error{
Â  Â  Â  border-color:#dc2626!important;
Â  Â  Â  box-shadow:0 0 0 1px rgba(220,38,38,.4)!important;
Â  Â  Â  background:#fef2f2!important;
Â  Â  }

Â  Â  .btn-main{
Â  Â  Â  width:100%;
Â  Â  Â  border:none;
Â  Â  Â  border-radius:999px;
Â  Â  Â  padding:10px;
Â  Â  Â  font-size:.96rem;
Â  Â  Â  font-weight:700;
Â  Â  Â  background:#0f766e;
Â  Â  Â  color:#fff;
Â  Â  Â  cursor:pointer;
Â  Â  Â  margin-top:10px;
Â  Â  }
Â  Â  .btn-main:hover{background:#115e59;}

Â  Â  .btn-sub{
Â  Â  Â  width:100%;
Â  Â  Â  margin-top:5px;
Â  Â  Â  border-radius:999px;
Â  Â  Â  padding:7px;
Â  Â  Â  font-size:.8rem;
Â  Â  Â  font-weight:600;
Â  Â  Â  border:1px solid #e5e7eb;
Â  Â  Â  background:#f9fafb;
Â  Â  Â  cursor:pointer;
Â  Â  }

Â  Â  .msg{
Â  Â  Â  margin-top:6px;
Â  Â  Â  font-size:.8rem;
Â  Â  Â  padding:5px 7px;
Â  Â  Â  border-radius:9px;
Â  Â  Â  display:none;
Â  Â  }
Â  Â  .msg-ok{
Â  Â  Â  background:#ecfdf3;
Â  Â  Â  border:1px solid #bbf7d0;
Â  Â  Â  color:#166534;
Â  Â  }
Â  Â  .msg-err{
Â  Â  Â  background:#fef2f2;
Â  Â  Â  border:1px solid #fecaca;
Â  Â  Â  color:#b91c1c;
Â  Â  }

Â  Â  /* ×›×•×›×‘×™× */
Â  Â  .stars{
Â  Â  Â  display:inline-flex;
Â  Â  Â  gap:3px;
Â  Â  Â  direction:ltr;
Â  Â  }
Â  Â  .star{
Â  Â  Â  font-size:1.3rem;
Â  Â  Â  cursor:pointer;
Â  Â  Â  color:#e5e7eb;
Â  Â  Â  transition:color .15s,transform .1s;
Â  Â  }
Â  Â  .star.filled{color:#f59e0b;}
Â  Â  .star:hover{transform:scale(1.1);}

Â  Â  /* ×¦'×™×¤×™× */
Â  Â  .traits{
Â  Â  Â  display:flex;
Â  Â  Â  flex-wrap:wrap;
Â  Â  Â  gap:5px;
Â  Â  Â  margin-top:3px;
Â  Â  }
Â  Â  .trait-chip{
Â  Â  Â  border-radius:999px;
Â  Â  Â  border:1px solid #d1d5db;
Â  Â  Â  padding:3px 8px;
Â  Â  Â  font-size:.78rem;
Â  Â  Â  cursor:pointer;
Â  Â  Â  background:#f9fafb;
Â  Â  Â  color:#374151;
Â  Â  }
Â  Â  .trait-chip.active{
Â  Â  Â  background:#0f766e;
Â  Â  Â  color:#fff;
Â  Â  Â  border-color:#0f766e;
Â  Â  }

Â  Â  /* ×¨×©×•××•×ª */
Â  Â  .records-wrap{
Â  Â  Â  margin-top:10px;
Â  Â  }
Â  Â  .records-title{
Â  Â  Â  font-size:.9rem;
Â  Â  Â  font-weight:700;
Â  Â  Â  color:#111827;
Â  Â  Â  margin-bottom:4px;
Â  Â  }
Â  Â  .record-card{
Â  Â  Â  background:#eef2ff;
Â  Â  Â  border:1px solid #c7d2fe;
Â  Â  Â  border-radius:12px;
Â  Â  Â  padding:8px 9px;
Â  Â  Â  margin-bottom:6px;
Â  Â  Â  font-size:.8rem;
Â  Â  Â  position:relative;
Â  Â  }
Â  Â  .record-header{
Â  Â  Â  display:flex;
Â  Â  Â  justify-content:space-between;
Â  Â  Â  gap:6px;
Â  Â  Â  margin-bottom:4px;
Â  Â  }
Â  Â  .record-meta{color:#4b5563;font-size:.76rem;}
Â  Â  .record-actions{
Â  Â  Â  display:flex;
Â  Â  Â  gap:4px;
Â  Â  }
Â  Â  .icon-btn{
Â  Â  Â  border:none;
Â  Â  Â  background:#fff;
Â  Â  Â  border-radius:999px;
Â  Â  Â  padding:1px 7px;
Â  Â  Â  font-size:.7rem;
Â  Â  Â  cursor:pointer;
Â  Â  Â  display:flex;
Â  Â  Â  align-items:center;
Â  Â  Â  gap:3px;
Â  Â  }
Â  Â  .icon-btn.del{color:#b91c1c;}
Â  Â  .icon-btn.edit{color:#065f46;}
Â  </style>
</head>
<body>
<div class="shell">

Â  <!-- ×›×¤×ª×•×¨×™× ×¢×œ×™×•× ×™× -->
Â  <div class="top-bar">
Â  Â  <button id="btnOpenRecords" class="top-btn">×¤×ª×— ×¨×©×•××•×ª</button>
Â  Â  <button id="btnTopClear" class="top-btn">××™×¤×•×¡ ×˜×•×¤×¡</button>
Â  Â  <button id="btnExportAdmin" class="top-btn main">×™×™×¦×•× / ×¤×ª×™×—×ª ×’×™×œ×™×•×Ÿ (×œ××•×¨×©×™×)</button>
Â  </div>

Â  <div class="card">
Â  Â  <h1>×¨×™×©×•× ××ª×¢× ×™×™× ×™×</h1>
Â  Â  <div class="subtitle">×—×•×‘×¨×ª ×¢×‘×•×“×” ××§×•×•× ×ª ×œ×™×¨×™×“ ××ª××—×™×</div>

Â  Â  <!-- ×¤×¨×˜×™ ××•×§×“ ×•× ×¦×™×’ -->
Â  Â  <div class="section-title">×¤×¨×˜×™ ××•×§×“ ×•× ×¦×™×’</div>
Â  Â  <div class="grid grid-2">
Â  Â  Â  <div>
Â  Â  Â  Â  <label class="req">××•×§×“</label>
Â  Â  Â  Â  <select id="center" class="short">
Â  Â  Â  Â  Â  <option value="">×‘×—×¨ ××•×§×“</option>
Â  Â  Â  Â  Â  <option>××•× ×™×‘×¨×¡×™×˜×ª ×¨×™×™×›××Ÿ</option>
Â  Â  Â  Â  Â  <option>(×¡×™××•×œ×¦×™×™×ª ×©×•×ª×¤×™× ×œ×“×¨×š)</option>
Â  Â  Â  Â  Â  <option>××•× ×™×‘×¨×¡×™×˜×ª ×‘×¨ ××™×œ×Ÿ</option>
Â  Â  Â  Â  Â  <option>××•× ×™×‘×¨×¡×™×˜×ª ×ª×œ-××‘×™×‘</option>
Â  Â  Â  Â  Â  <option>××›×œ×œ×ª ×©×¢×¨×™ ××“×¢ ×•××©×¤×˜</option>
Â  Â  Â  Â  Â  <option>×©×•×ª×¤×™× ×œ×“×¨×š</option>
Â  Â  Â  Â  Â  <option>××›×œ×œ×ª ×¡×¤×™×¨</option>
Â  Â  Â  Â  Â  <option>×”××›×œ×œ×” ×œ×× ×”×œ ×¨××©×œ"×¦</option>
Â  Â  Â  Â  Â  <option>×”××•× ×™×‘×¨×¡×™×˜×” ×”×¢×‘×¨×™×ª</option>
Â  Â  Â  Â  </select>
Â  Â  Â  </div>
Â  Â  Â  <div>
Â  Â  Â  Â  <label class="req">×©× × ×¦×™×’</label>
Â  Â  Â  Â  <select id="agent" class="short-inline">
Â  Â  Â  Â  Â  <option value="">×‘×—×¨ × ×¦×™×’</option>
Â  Â  Â  Â  </select>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="grid" style="margin-top:6px;">
Â  Â  Â  <div style="max-width:190px;">
Â  Â  Â  Â  <label>×ª××¨×™×š ×™×¨×™×“</label>
Â  Â  Â  Â  <input id="date" type="date">
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- ×¤×¨×˜×™ ×¡×˜×•×“× ×˜ -->
Â  Â  <div class="section-title">×¤×¨×˜×™ ×¡×˜×•×“× ×˜</div>
Â  Â  <div class="grid">
Â  Â  Â  <div>
Â  Â  Â  Â  <label>×©× ×¡×˜×•×“× ×˜</label>
Â  Â  Â  Â  <input id="name" type="text" placeholder="×œ×“×•×’××”: ×“× ×” ×›×”×Ÿ">
Â  Â  Â  </div>

Â  Â  Â  <div class="grid grid-2">
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <label>×©× ×”</label>
Â  Â  Â  Â  Â  <select id="year">
Â  Â  Â  Â  Â  Â  <option value="">×‘×—×¨ ×©× ×”</option>
Â  Â  Â  Â  Â  Â  <option>×©× ×” ×'</option>
Â  Â  Â  Â  Â  Â  <option>×©× ×” ×‘'</option>
Â  Â  Â  Â  Â  Â  <option>×©× ×” ×’'</option>
Â  Â  Â  Â  Â  Â  <option>×©× ×” ×“'</option>
Â  Â  Â  Â  Â  Â  <option>×¡×˜××–'</option>
Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <label>×¢×™×¨</label>
Â  Â  Â  Â  Â  <input id="city" type="text" placeholder="×œ×“×•×’××”: × ×ª× ×™×”">
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="grid grid-2">
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <label>×˜×œ×¤×•×Ÿ</label>
Â  Â  Â  Â  Â  <input id="phone" type="tel" inputmode="tel" placeholder="050-0000000">
Â  Â  Â  Â  Â  <div class="hint">9â€“10 ×¡×¤×¨×•×ª, × ×™×ª×Ÿ ×¢× ××§×¤×™×</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <label>××™×™×œ</label>
Â  Â  Â  Â  Â  <input id="email" type="email" class="short" placeholder="example@mail.com">
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div>
Â  Â  Â  Â  <label>×ª×—×•× ××•×¢×“×£</label>
Â  Â  Â  Â  <select id="field">
Â  Â  Â  Â  Â  <option value="">×‘×—×¨ ×ª×—×•×</option>
Â  Â  Â  Â  Â  <option>×œ×™×˜×™×’×¦×™×”</option>
Â  Â  Â  Â  Â  <option>××¡×—×¨×™</option>
Â  Â  Â  Â  Â  <option>×—×“×œ×•×ª ×¤×™×¨×¢×•×Ÿ</option>
Â  Â  Â  Â  Â  <option>×“×™× ×™ ×¢×‘×•×“×”</option>
Â  Â  Â  Â  Â  <option>× ×–×™×§×™×Ÿ</option>
Â  Â  Â  Â  Â  <option>××©×¤×—×”</option>
Â  Â  Â  Â  Â  <option>×¤×œ×™×œ×™</option>
Â  Â  Â  Â  </select>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- ×”×ª×¨×©××•×ª -->
Â  Â  <div class="section-title">×”×ª×¨×©××•×ª ××”×¡×˜×•×“× ×˜</div>
Â  Â  <div class="grid">
Â  Â  Â  <div>
Â  Â  Â  Â  <label>×“×™×¨×•×’ (×›×•×›×‘×™×)</label>
Â  Â  Â  Â  <div id="stars" class="stars">
Â  Â  Â  Â  Â  <span class="star" data-val="1">â˜…</span>
Â  Â  Â  Â  Â  <span class="star" data-val="2">â˜…</span>
Â  Â  Â  Â  Â  <span class="star" data-val="3">â˜…</span>
Â  Â  Â  Â  Â  <span class="star" data-val="4">â˜…</span>
Â  Â  Â  Â  Â  <span class="star" data-val="5">â˜…</span>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div>
Â  Â  Â  Â  <label>×××¤×™×™× ×™× ×‘×•×œ×˜×™×</label>
Â  Â  Â  Â  <div id="traitsBox" class="traits">
Â  Â  Â  Â  Â  <span class="trait-chip" data-t="×—×¨×™×¦×•×ª">×—×¨×™×¦×•×ª</span>
Â  Â  Â  Â  Â  <span class="trait-chip" data-t="××§×¦×•×¢×™×•×ª">××§×¦×•×¢×™×•×ª</span>
Â  Â  Â  Â  Â  <span class="trait-chip" data-t="× ×™×¡×™×•×Ÿ">× ×™×¡×™×•×Ÿ</span>
Â  Â  Â  Â  Â  <span class="trait-chip" data-t="×©×¤×” ×¢×©×™×¨×”">×©×¤×” ×¢×©×™×¨×”</span>
Â  Â  Â  Â  Â  <span class="trait-chip" data-t="×›×¨×™×–××˜×™">×›×¨×™×–××˜×™</span>
Â  Â  Â  Â  Â  <span class="trait-chip" data-t="×•×¨×‘×œ×™">×•×¨×‘×œ×™</span>
Â  Â  Â  Â  Â  <span class="trait-chip" data-t="×‘×™×™×©×Ÿ">×‘×™×™×©×Ÿ</span>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div>
Â  Â  Â  Â  <label>×”×ª×¨×©××•×ª ×›×œ×œ×™×ª</label>
Â  Â  Â  Â  <textarea id="impression" placeholder="×¨×•×©×, ×”×ª×××”, ×—×•×•"×“..."></textarea>
Â  Â  Â  </div>

Â  Â  Â  <div>
Â  Â  Â  Â  <label>×”×¢×¨×•×ª ×¤× ×™××™×•×ª</label>
Â  Â  Â  Â  <textarea id="notes" placeholder="×¤×¨×˜×™ ×”××©×š ×˜×™×¤×•×œ, ×ª×–×›×•×¨×•×ª ×•×¢×•×“..."></textarea>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <button id="btnSave" class="btn-main">×”×•×¡×£ ×¨×©×•××”</button>
Â  Â  <button id="btnClear" class="btn-sub">× ×§×” ×˜×•×¤×¡</button>

Â  Â  <div id="msgOk" class="msg msg-ok">×”×¨×©×•××” × ×©××¨×” ×•× ×©×œ×—×” ×œ×¡× ×›×¨×•×Ÿ.</div>
Â  Â  <div id="msgErr" class="msg msg-err"></div>

Â  </div>

Â  <!-- ×¨×©×•××•×ª -->
Â  <div class="records-wrap">
Â  Â  <div class="records-title">×¨×©×•××•×ª ×©×”×•×–× ×• ××”××›×©×™×¨ ×”×–×”</div>
Â  Â  <div id="recordsList"></div>
Â  </div>

</div>
Â Â 
<script>
Â  // ===== ×”×’×“×¨×•×ª =====
const API_URLÂ  Â  = 'https://script.google.com/macros/s/AKfycbwip8xRO6q99yg_iX5KRddVmv3suZmeCEQJ4_TGY4MVtENw3WcrDHUEnTUBI3D7KdE/exec'; // URL ×–×× ×™
const ADMIN_CODE = '2100';
const SHEET_URLÂ  = 'https://docs.google.com/spreadsheets/d/1Oz32yNCobHdhz0APS4zl5O34rkqZxGvP0TJgPKKDLdk/edit?pli=1&gid=487137334#gid=487137334'; // ××•×¤×¦×™×•× ×œ×™
Â  const STORAGE_KEY = 'lfp_records_v4';
Â  const OWNER_KEYÂ  Â = 'lfp_owner_id_v1';

Â  let records = [];
Â  let ownerId = null;
Â  let editingId = null;
Â  let currentRating = 0;

Â  const E = id => document.getElementById(id);

Â  // ===== ×œ×•×— ×–×× ×™×: ××•×§×“ â†’ ×ª××¨×™×š + × ×¦×™×’×™× =====
Â  const FAIR_SCHEDULE = [
Â  Â  { centerName:"××•× ×™×‘×¨×¡×™×˜×ª ×¨×™×™×›××Ÿ",Â  Â  Â  Â  Â  Â  date:"2025-12-01", agents:["×™×¢×§×‘","××•×¤×™×¨","×©×§×“","×’×œ"] },
Â  Â  { centerName:"(×¡×™××•×œ×¦×™×™×ª ×©×•×ª×¤×™× ×œ×“×¨×š)",Â  Â  Â date:"2025-12-02", agents:["××•×¨×™","××™×ª×™ ×©×’×‘","×¦×™×•× ×”"] },
Â  Â  { centerName:"××•× ×™×‘×¨×¡×™×˜×ª ×‘×¨ ××™×œ×Ÿ",Â  Â  Â  Â  Â  date:"2025-12-03", agents:["××™×œ×•×Ÿ","×™×¢×§×‘","××œ×™××‘","×‘×™×¡××Ÿ"] },
Â  Â  { centerName:"××•× ×™×‘×¨×¡×™×˜×ª ×ª×œ-××‘×™×‘",Â  Â  Â  Â  Â  date:"2025-12-04", agents:["××•×¨×™","××•×¤×™×¨","×¦×œ×™×œ"] },
Â  Â  { centerName:"××›×œ×œ×ª ×©×¢×¨×™ ××“×¢ ×•××©×¤×˜",Â  Â  Â  Â  Â date:"2025-12-08", agents:["××•×¨×™","××•×¤×™×¨","×¦×œ×™×œ"] },
Â  Â  { centerName:"×©×•×ª×¤×™× ×œ×“×¨×š",Â  Â  Â  Â  Â  Â  Â  Â  Â date:"2025-12-08", agents:["××™×ª×™*","×¦×™×•× ×”*"] },
Â  Â  { centerName:"××›×œ×œ×ª ×¡×¤×™×¨",Â  Â  Â  Â  Â  Â  Â  Â  Â  Â date:"2025-12-09", agents:["×‘×§×™","××™×ª×™"] },
Â  Â  { centerName:"×”××›×œ×œ×” ×œ×× ×”×œ ×¨××©×œ\"×¦",Â  Â  Â  Â  Â date:"2025-12-25", agents:["××•×¨×™","×¦×™×•× ×”","××•×¤×™×¨"] },
Â  Â  { centerName:"×”××•× ×™×‘×¨×¡×™×˜×” ×”×¢×‘×¨×™×ª",Â  Â  Â  Â  Â  date:"2025-12-28", agents:["××•×¨×™","××œ×™××‘"] }
Â  ];

Â  function initOwner(){
Â  Â  ownerId = localStorage.getItem(OWNER_KEY);
Â  Â  if(!ownerId){
Â  Â  Â  ownerId = 'u_' + Date.now() + '_' + Math.random().toString(36).slice(2,8);
Â  Â  Â  localStorage.setItem(OWNER_KEY, ownerId);
Â  Â  }
Â  }

Â  // ===== ×˜×œ×¤×•×Ÿ â€“ ×œ××¤×©×¨ ×¨×§ ×¡×¤×¨×•×ª, ×œ×”×’×‘×™×œ ×œ-10 =====
Â  E('phone').addEventListener('input', () => {
Â  Â  const digits = E('phone').value.replace(/\D/g,'').slice(0,10);
Â  Â  E('phone').value = digits;
Â  });

Â  // ===== ×›×•×›×‘×™× =====
Â  function updateStars(v){
Â  Â  currentRating = v;
Â  Â  document.querySelectorAll('#stars .star').forEach(s=>{
Â  Â  Â  const val = Number(s.dataset.val);
Â  Â  Â  s.classList.toggle('filled', val<=v);
Â  Â  });
Â  }
Â  document.querySelectorAll('#stars .star').forEach(s=>{
Â  Â  s.addEventListener('click',()=>updateStars(Number(s.dataset.val)));
Â  });

Â  // ===== ×¦'×™×¤×™× =====
Â  document.querySelectorAll('.trait-chip').forEach(ch=>{
Â  Â  ch.addEventListener('click',()=>ch.classList.toggle('active'));
Â  });
Â Â 
Â  // ===== ×‘×—×™×¨×ª ××•×§×“ â†’ ×ª××¨×™×š + ×¨×©×™××ª × ×¦×™×’×™× =====
Â  function onCenterChange(){
Â  Â  const val = E('center').value;
Â  Â  const slot = FAIR_SCHEDULE.find(s=>s.centerName===val);
Â  Â  // ×ª××¨×™×š
Â  Â  if(slot){
Â  Â  Â  E('date').value = slot.date;
Â  Â  Â  // × ×¦×™×’×™×
Â  Â  Â  const agentSel = E('agent');
Â  Â  Â  agentSel.innerHTML = '<option value="">×‘×—×¨ × ×¦×™×’</option>';
Â  Â  Â  slot.agents.forEach(a=>{
Â  Â  Â  Â  const clean = a.replace('*','').trim();
Â  Â  Â  Â  const opt = document.createElement('option');
Â  Â  Â  Â  opt.value = clean;
Â  Â  Â  Â  opt.textContent = clean;
Â  Â  Â  Â  agentSel.appendChild(opt);
Â  Â  Â  });
Â  Â  }else{
Â  Â  Â  E('date').value = '';
Â  Â  Â  E('agent').innerHTML = '<option value="">×‘×—×¨ × ×¦×™×’</option>';
Â  Â  }
Â  }
Â  E('center').addEventListener('change', onCenterChange);

Â  // ===== ×•×œ×™×“×¦×™×” =====
Â  function clearErrors(){
Â  Â  ['center','agent','phone','email'].forEach(id=>E(id).classList.remove('error'));
Â  Â  E('msgErr').style.display='none';
Â  Â  E('msgOk').style.display='none';
Â  }

Â  function isValidPhone(p){
Â  Â  const d = (p||'').replace(/\D/g,'');
Â  Â  return !d || d.length===9 || d.length===10;
Â  }

Â  function isValidEmail(e){
Â  Â  if(!e) return true;
Â  Â  const re=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;
Â  Â  return re.test(e);
Â  }

Â  // ===== ×©××™×¨×” / ×¢×“×›×•×Ÿ =====
Â  Â // ===== ×©××™×¨×” / ×¢×“×›×•×Ÿ =====
Â  async function saveRecord(){
Â  Â  clearErrors();

Â  Â  const center = E('center').value.trim();
Â  Â  const agentÂ  = E('agent').value.trim();
Â  Â  const dateÂ  Â = E('date').value;

Â  Â  const nameÂ  Â = E('name').value.trim();
Â  Â  const yearÂ  Â = E('year').value;
Â  Â  const cityÂ  Â = E('city').value.trim();
Â  Â  const phoneÂ  = E('phone').value.trim();
Â  Â  const emailÂ  = E('email').value.trim();
Â  Â  const fieldÂ  = E('field').value;
Â  Â  const impression = E('impression').value.trim();
Â  Â  const notesÂ  Â  Â  = E('notes').value.trim();

Â  Â  const traits = Array.from(
Â  Â  Â  document.querySelectorAll('.trait-chip.active')
Â  Â  ).map(ch=>ch.dataset.t);

Â  Â  const errors = [];
Â  Â  if(!center){errors.push('×™×© ×œ×‘×—×•×¨ ××•×§×“.');E('center').classList.add('error');}
Â  Â  if(!agent){errors.push('×™×© ×œ×‘×—×•×¨ × ×¦×™×’.');E('agent').classList.add('error');}
Â  Â  if(!isValidPhone(phone)){errors.push('××¡×¤×¨ ×”×˜×œ×¤×•×Ÿ ××™× ×• ×ª×§×™×Ÿ.');E('phone').classList.add('error');}
Â  Â  if(!isValidEmail(email)){errors.push('×›×ª×•×‘×ª ×”××™×™×œ ××™× ×” ×ª×§×™× ×”.');E('email').classList.add('error');}

Â  Â  if(errors.length){
Â  Â  Â  E('msgErr').textContent = errors.join(' ');
Â  Â  Â  E('msgErr').style.display='block';
Â  Â  Â  return;
Â  Â  }

Â  Â // ×§×•×“ ××ª×•×§×Ÿ (×”×¢×ª×§ ×•×”×“×‘×§ ×‘××§×•× ×”×‘×œ×•×§ ×”×§×•×“×)

Â  Â  const id = editingId || ('r_'+Date.now()+'_'+Math.random().toString(36).slice(2,7));

Â  Â  // *** ×ª×—×™×œ×ª ×”×•×¡×¤×” ***
Â  Â  // ××—×©×‘ ××ª ×”×©×¢×” ×”× ×•×›×—×™×ª ×•×××™×¨ ××•×ª×” ×œ××—×¨×•×–×ª (×œ×“×•×’××”: "13:41")
Â  Â  const now = new Date();
Â  Â  const time = now.toLocaleTimeString('he-IL', {hour:'2-digit', minute:'2-digit'});
Â  Â  // *** ×¡×•×£ ×”×•×¡×¤×” ***

Â  Â  const rec = {
Â  Â  Â  id, ownerId,
Â  Â  Â  center, agent, date,
Â  Â  Â  // *** ×”×•×¡×£ ××ª ×”×©×¢×” ×›××Ÿ ***
Â  Â  Â  time,
Â  Â  Â  // *** ×¡×•×£ ×”×•×¡×¤×” ***
Â  Â  Â  name, year, city, phone, email, field,
Â  Â  Â  rating:currentRating, traits, impression, notes
Â  Â  };

Â  Â  // ×¢×“×›×•×Ÿ ×‘××¢×¨×š / ×—×“×©
Â  Â  const idx = records.findIndex(r=>r.id===id);
Â  Â  if(idx>=0) records[idx]=rec;
Â  Â  else records.push(rec);
Â  Â  persistRecords();
Â  Â  renderRecords();

Â  Â  // ×©×œ×™×—×” ×œ×¡×§×¨×™×¤×˜ (×”×•×¡×¤×”/×¢×“×›×•×Ÿ â€“ action:add)
Â  Â  try{
Â  Â  Â  if(API_URL && API_URL.includes('script.google.com')){
Â  Â  Â  Â  const res = await fetch(API_URL,{
Â  Â  Â  Â  Â  method:'POST',
Â  Â  Â  Â  Â  body:JSON.stringify({action:'add',ownerId,record:rec})
Â  Â  Â  Â  });
Â  Â  Â  Â  const txt = await res.text();
Â  Â  Â  Â  console.log('API response:', res.status, txt);
Â  Â  Â  }

Â  Â  Â  // === ×›××Ÿ ×”×©×™× ×•×™: ×”×•×“×¢×” ×™×¨×•×§×” + ×”×•×“×¢×” ×§×•×¤×¦×ª ===
Â  Â  Â  E('msgOk').textContent = '×”×˜×•×¤×¡ × ×©×œ×— ×‘×”×¦×œ×—×”!'; // ×˜×§×¡×˜ ×‘×¤×¡ ×”×™×¨×•×§
Â  Â  Â  E('msgOk').style.display='block';
Â  Â  Â Â 
Â  Â  Â  alert('×”× ×ª×•× ×™× × ×©××¨×• ×‘×”×¦×œ×—×”!'); // <--- ×©×•×¨×” ×—×“×©×”: ×”×•×“×¢×” ×§×•×¤×¦×ª

Â  Â  } catch(err){
Â  Â  Â  console.error('sync error:', err);
Â  Â  Â  E('msgErr').textContent = '×©×’×™××” ×‘×©×œ×™×—×”.';
Â  Â  Â  E('msgErr').style.display='block';
Â  Â  }

Â  Â  clearForm(false);
Â  }
Â  // ===== ×¨×©×•××•×ª ×‘×œ×•×§××œ×¡×˜×•×¨×’' =====
Â  function loadRecords(){
Â  Â  try{
Â  Â  Â  const raw = localStorage.getItem(STORAGE_KEY);
Â  Â  Â  records = raw ? JSON.parse(raw) : [];
Â  Â  }catch{
Â  Â  Â  records=[];
Â  Â  }
Â  }
Â  function persistRecords(){
Â  Â  localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
Â  }

Â  function renderRecords(){
Â  Â  const box = E('recordsList');
Â  Â  box.innerHTML='';
Â  Â  const mine = records.filter(r=>r.ownerId===ownerId);
Â  Â  if(!mine.length){
Â  Â  Â  box.innerHTML='<div style="font-size:.78rem;color:#9ca3af;">××™×Ÿ ×¨×©×•××•×ª ×œ×”×¦×’×”.</div>';
Â  Â  Â  return;
Â  Â  }
Â  Â  mine.forEach(r=>{
Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  div.className='record-card';
Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  <div class="record-header">
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <strong>${r.name || '×œ×œ× ×©×'}</strong>
Â  Â  Â  Â  Â  Â  <div class="record-meta">${r.center || ''} Â· ${r.agent || ''}</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="record-actions">
Â  Â  Â  Â  Â  Â  <button class="icon-btn edit" data-id="${r.id}">âœ ×¢×¨×•×š</button>
Â  Â  Â  Â  Â  Â  <button class="icon-btn del" data-id="${r.id}">ğŸ—‘ ××—×§</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="record-meta">
Â  Â  Â  Â  Â  ×ª××¨×™×š: ${r.date || '-'} Â· ×˜×œ×¤×•×Ÿ: ${r.phone || '-'} Â· ××™×™×œ: ${r.email || '-'}
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  Â  box.appendChild(div);
Â  Â  });

Â  Â  // ××™×¨×•×¢×™ ×¢×¨×™×›×” / ××—×™×§×”
Â  Â  box.querySelectorAll('.icon-btn.edit').forEach(btn=>{
Â  Â  Â  btn.addEventListener('click',()=>startEdit(btn.dataset.id));
Â  Â  });
Â  Â  box.querySelectorAll('.icon-btn.del').forEach(btn=>{
Â  Â  Â  btn.addEventListener('click',()=>deleteRecord(btn.dataset.id));
Â  Â  });
Â  }

Â  function startEdit(id){
Â  Â  const r = records.find(x=>x.id===id);
Â  Â  if(!r) return;
Â  Â  editingId = id;

Â  Â  E('center').value=r.center||'';
Â  Â  onCenterChange(); // ×™××œ× ×ª××¨×™×š ×•× ×¦×™×’×™×
Â  Â  E('agent').value=r.agent||'';
Â  Â  E('date').value=r.date||'';

Â  Â  E('name').value=r.name||'';
Â  Â  E('year').value=r.year||'';
Â  Â  E('city').value=r.city||'';
Â  Â  E('phone').value=r.phone||'';
Â  Â  E('email').value=r.email||'';
Â  Â  E('field').value=r.field||'';
Â  Â  E('impression').value=r.impression||'';
Â  Â  E('notes').value=r.notes||'';

Â  Â  document.querySelectorAll('.trait-chip').forEach(ch=>{
Â  Â  Â  const t = ch.dataset.t;
Â  Â  Â  ch.classList.toggle('active', (r.traits||[]).includes(t));
Â  Â  });
Â  Â  updateStars(r.rating||0);
Â  Â  window.scrollTo({top:0,behavior:'smooth'});
Â  }

Â  async function deleteRecord(id){
Â  Â  const r = records.find(x=>x.id===id);
Â  Â  if(!r) return;
Â  Â  if(!confirm('×œ××—×•×§ ××ª ×”×¨×©×•××”? ×”×™× ×ª×¡×•××Ÿ ×›××—×•×§×” ×‘×’×™×œ×™×•×Ÿ.')) return;

Â  Â  records = records.filter(x=>x.id!==id);
Â  Â  persistRecords();
Â  Â  renderRecords();

Â  Â  try{
Â  Â  Â  if(API_URL && API_URL.includes('script.google.com')){
Â  Â  Â  Â  await fetch(API_URL,{
Â  Â  Â  Â  Â  method:'POST',
Â  Â  Â  Â  Â  headers:{'Content-Type':'application/json'},
Â  Â  Â  Â  Â  body:JSON.stringify({action:'delete',ownerId,record:r})
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  }catch(err){
Â  Â  Â  // ×× × ×›×©×œ â€“ ×œ× × ×•×¨×, ×™×© ×¢×•×ª×§ ××§×•××™
Â  Â  }
Â  }

Â  // ===== ×›×¤×ª×•×¨×™× ×¢×œ×™×•× ×™× =====
Â  E('btnTopClear').addEventListener('click',()=>clearForm(true));

Â  E('btnOpenRecords').addEventListener('click',()=>{
Â  Â  const el = E('recordsList');
Â  Â  if(el) el.scrollIntoView({behavior:'smooth'});
Â  });

Â  E('btnExportAdmin').addEventListener('click',()=>{
Â  Â  const code = prompt('×”×›× ×¡ ×§×•×“ ××•×¨×©×”:');
Â  Â  if(code===ADMIN_CODE){
Â  Â  Â  if(SHEET_URL.startsWith('http')){
Â  Â  Â  Â  window.open(SHEET_URL,'_blank');
Â  Â  Â  }else{
Â  Â  Â  Â  alert('×¢×“×›×Ÿ ××ª SHEET_URL ×‘×§×•×“ ×¢×œ ×× ×ª ×œ×¤×ª×•×— ××ª ×”×’×™×œ×™×•×Ÿ.');
Â  Â  Â  }
Â  Â  }else if(code){
Â  Â  Â  alert('×§×•×“ ×©×’×•×™.');
Â  Â  }
Â  });

Â  // ===== ××™×¤×•×¡ ×”×•×“×¢×•×ª =====
Â  E('btnClear').addEventListener('click',()=>clearForm(true));
Â  E('btnSave').addEventListener('click',saveRecord);

Â  // ===== INIT =====
Â  (function init(){
Â  Â  initOwner();
Â  Â  loadRecords();
Â  Â  renderRecords();
Â  })();
</script>
</body>
</html>

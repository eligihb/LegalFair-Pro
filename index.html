<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>רישום מתעניינים – יריד מתמחים</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700&display=swap" rel="stylesheet" />

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 12px;
      font-family: "Heebo", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f3f4f6;
      color: #111827;
      direction: rtl;
    }

    .shell {
      max-width: 480px;
      margin: 0 auto;
    }

    .card {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.15);
      padding: 16px 14px 18px;
    }

    h1 {
      margin: 0 0 6px;
      font-size: 1.4rem;
      text-align: center;
      color: #0f766e;
    }

    .subtitle {
      text-align: center;
      font-size: 0.9rem;
      color: #6b7280;
      margin-bottom: 12px;
    }

    .section-title {
      margin: 12px 0 6px;
      font-size: 0.95rem;
      font-weight: 700;
      color: #0f766e;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 4px;
    }

    .grid {
      display: grid;
      gap: 8px;
    }

    /* מוקד + נציג + תאריך – שתי עמודות בדסקטופ, עמודה אחת במובייל */
    .grid-2 {
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
    }

    @media (max-width: 600px) {
      .grid-2 {
        grid-template-columns: 1fr;
      }
    }

    label {
      display: block;
      font-size: 0.86rem;
      font-weight: 600;
      color: #374151;
      margin-bottom: 2px;
    }

    .req::after {
      content: " *";
      color: #b91c1c;
      font-weight: 700;
    }

    input, select, textarea {
      width: 100%;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      padding: 7px 9px;
      font-size: 0.95rem;
      background: #f9fafb;
      transition: border-color 0.15s, box-shadow 0.15s, background 0.15s;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #0f766e;
      box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.25);
      background: #ffffff;
    }

    textarea {
      resize: vertical;
      min-height: 70px;
    }

    /* שדות "צרים" יחסית */
    .short-input {
      max-width: 230px;
    }

    .short-input-inline {
      max-width: 200px;
    }

    .error {
      border-color: #dc2626 !important;
      box-shadow: 0 0 0 1px rgba(220, 38, 38, 0.4) !important;
      background: #fef2f2 !important;
    }

    .hint {
      font-size: 0.78rem;
      color: #9ca3af;
      margin-top: 2px;
    }

    .btn-main {
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 11px;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      background: #0f766e;
      color: #ffffff;
      margin-top: 10px;
    }

    .btn-main:hover {
      background: #115e59;
    }

    .btn-clear {
      width: 100%;
      border-radius: 999px;
      padding: 9px;
      font-size: 0.9rem;
      font-weight: 600;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      color: #4b5563;
      margin-top: 6px;
      cursor: pointer;
    }

    .btn-clear:hover {
      background: #f3f4f6;
    }

    .msg {
      margin-top: 8px;
      font-size: 0.85rem;
      padding: 6px 8px;
      border-radius: 10px;
      display: none;
    }

    .msg-ok {
      background: #ecfdf3;
      color: #166534;
      border: 1px solid #bbf7d0;
    }

    .msg-err {
      background: #fef2f2;
      color: #b91c1c;
      border: 1px solid #fecaca;
    }

    /* דירוג כוכבים */
    .stars {
      display: inline-flex;
      gap: 4px;
      direction: ltr; /* שהכוכבים יהיו בצד הנכון */
    }

    .star {
      font-size: 1.4rem;
      cursor: pointer;
      color: #e5e7eb;
      transition: color 0.15s, transform 0.1s;
    }

    .star.filled {
      color: #f59e0b;
    }

    .star:hover {
      transform: scale(1.1);
    }

    /* מאפייני מועמד (צ'יפים) */
    .traits {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .trait-chip {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 3px 9px;
      font-size: 0.8rem;
      cursor: pointer;
      background: #f9fafb;
      color: #374151;
    }

    .trait-chip.active {
      background: #0f766e;
      color: #ffffff;
      border-color: #0f766e;
    }
  </style>
</head>

<body>
<div class="shell">
  <div class="card">
    <h1>רישום מתעניינים</h1>
    <div class="subtitle">חוברת עבודה מקוונת ליריד המתמחים</div>

    <!-- פרטי מוקד ונציג -->
    <div class="section-title">פרטי מוקד ונציג</div>
    <div class="grid grid-2">
      <div>
        <label class="req">מוקד</label>
        <select id="center" class="short-input">
          <option value="">בחר מוקד</option>
          <option>אוניברסיטת רייכמן</option>
          <option>(סימולציית שותפים לדרך)</option>
          <option>אוניברסיטת בר אילן</option>
          <option>אוניברסיטת תל-אביב</option>
          <option>מכללת שערי מדע ומשפט</option>
          <option>שותפים לדרך</option>
          <option>מכללת ספיר</option>
          <option>המכללה למנהל ראשל"צ</option>
          <option>האוניברסיטה העברית</option>
        </select>
      </div>

      <div>
        <label class="req">שם נציג</label>
        <input id="agent" type="text" class="short-input-inline" placeholder="שם מלא" />
      </div>
    </div>

    <div class="grid" style="margin-top:8px;">
      <div style="max-width:190px;">
        <label>תאריך יריד</label>
        <input id="date" type="date" />
      </div>
    </div>

    <!-- פרטי סטודנט -->
    <div class="section-title">פרטי סטודנט</div>
    <div class="grid">
      <div>
        <label>שם סטודנט</label>
        <input id="name" type="text" placeholder="לדוגמה: דנה כהן" />
      </div>

      <div class="grid grid-2">
        <div>
          <label>שנה</label>
          <select id="year">
            <option value="">בחר שנה</option>
            <option>שנה א'</option>
            <option>שנה ב'</option>
            <option>שנה ג'</option>
            <option>שנה ד'</option>
            <option>סטאז'</option>
          </select>
        </div>
        <div>
          <label>עיר</label>
          <input id="city" type="text" placeholder="לדוגמה: נתניה" />
        </div>
      </div>

      <div class="grid grid-2">
        <div>
          <label>טלפון</label>
          <input id="phone" type="tel" placeholder="050-0000000" />
          <div class="hint">9–10 ספרות, ניתן עם מקפים</div>
        </div>
        <div>
          <label>מייל</label>
          <input id="email" type="email" class="short-input" placeholder="example@mail.com" />
        </div>
      </div>

      <div>
        <label>תחום מועדף</label>
        <select id="field">
          <option value="">בחר תחום</option>
          <option>ליטיגציה</option>
          <option>מסחרי</option>
          <option>חדלות פירעון</option>
          <option>דיני עבודה</option>
          <option>נזיקין</option>
          <option>משפחה</option>
          <option>פלילי</option>
        </select>
      </div>
    </div>

    <!-- התרשמות ודירוג -->
    <div class="section-title">התרשמות מהסטודנט</div>
    <div class="grid">
      <div>
        <label>דירוג (כוכבים)</label>
        <div class="stars" id="stars">
          <span class="star" data-val="1">★</span>
          <span class="star" data-val="2">★</span>
          <span class="star" data-val="3">★</span>
          <span class="star" data-val="4">★</span>
          <span class="star" data-val="5">★</span>
        </div>
      </div>

      <div>
        <label>מאפיינים בולטים</label>
        <div class="traits" id="traitsBox">
          <span class="trait-chip" data-t="חריצות">חריצות</span>
          <span class="trait-chip" data-t="מקצועיות">מקצועיות</span>
          <span class="trait-chip" data-t="ניסיון">ניסיון</span>
          <span class="trait-chip" data-t="שפה עשירה">שפה עשירה</span>
          <span class="trait-chip" data-t="כריזמטי">כריזמטי</span>
          <span class="trait-chip" data-t="ורבלי">ורבלי</span>
          <span class="trait-chip" data-t="ביישן">ביישן</span>
        </div>
      </div>

      <div>
        <label>התרשמות כללית</label>
        <textarea id="impression" placeholder="רושם, התאמה למשרד, נקודות לחיוב / לשיפור..."></textarea>
      </div>

      <div>
        <label>הערות פנימיות</label>
        <textarea id="notes" placeholder="פרטים טכניים, תיאומים, המשך טיפול ועוד..."></textarea>
      </div>
    </div>

    <button class="btn-main" id="btnSave">הוסף רשומה</button>
    <button class="btn-clear" id="btnClear">נקה טופס</button>

    <div id="msgOk" class="msg msg-ok">הרשומה נשמרה מקומית. (חיבור לגוגל שיטס יתוסף דרך ה־Apps Script)</div>
    <div id="msgErr" class="msg msg-err"></div>

  </div>
</div>

<script>
  // ===== לוח זמנים של יריד מתמחים =====
  const FAIR_SCHEDULE = [
    { centerId: "reichman",  centerName: "אוניברסיטת רייכמן",             date: "2025-12-01", agents: ["יעקב", "אופיר", "שקד", "גל"] },
    { centerId: "partners_sim", centerName: "(סימולציית שותפים לדרך)",  date: "2025-12-02", agents: ["אורי", "איתי שגב", "ציונה"] },
    { centerId: "barilan",   centerName: "אוניברסיטת בר אילן",           date: "2025-12-03", agents: ["אילון", "יעקב", "אליאב", "ביסאן"] },
    { centerId: "tau",       centerName: "אוניברסיטת תל-אביב",           date: "2025-12-04", agents: ["אורי", "אופיר", "צליל"] },
    { centerId: "shaarim",   centerName: "מכללת שערי מדע ומשפט",          date: "2025-12-08", agents: ["אורי", "אופיר", "צליל"] },
    { centerId: "partners",  centerName: "שותפים לדרך",                   date: "2025-12-08", agents: ["איתי*", "ציונה*"] },
    { centerId: "sapir",     centerName: "מכללת ספיר",                    date: "2025-12-09", agents: ["בקי", "איתי"] },
    { centerId: "colman",    centerName: "המכללה למנהל ראשל\"צ",          date: "2025-12-25", agents: ["אורי", "ציונה", "אופיר"] },
    { centerId: "huji",      centerName: "האוניברסיטה העברית",           date: "2025-12-28", agents: ["אורי", "אליאב"] }
  ];

  // מיפוי נציג → מוקדים ותאריכים
  const AGENT_MAP = {};
  FAIR_SCHEDULE.forEach(slot => {
    slot.agents.forEach(name => {
      const cleanName = name.replace("*", "").trim();
      if (!AGENT_MAP[cleanName]) AGENT_MAP[cleanName] = [];
      AGENT_MAP[cleanName].push({
        centerId:   slot.centerId,
        centerName: slot.centerName,
        date:       slot.date
      });
    });
  });

  const E = id => document.getElementById(id);

  let currentRating = 0;

  // ===== מילוי אוטומטי לפי שם נציג =====
  function autoFillByAgent() {
    const name = E("agent").value.trim();
    if (!name) return;

    const matches = AGENT_MAP[name] || [];

    if (matches.length === 1) {
      const m = matches[0];
      E("center").value = m.centerName;
      E("date").value   = m.date;
    } else if (matches.length > 1) {
      const list = matches.map((m, i) => `${i + 1}. ${m.centerName} (${m.date})`).join("\n");
      const choice = prompt("הנציג משויך לכמה מוקדים.\nבחר מספר:\n\n" + list);
      const idx = parseInt(choice, 10) - 1;
      if (!isNaN(idx) && matches[idx]) {
        const m = matches[idx];
        E("center").value = m.centerName;
        E("date").value   = m.date;
      }
    }
  }

  // ===== כוכבי דירוג =====
  function updateStars(val) {
    currentRating = val;
    document.querySelectorAll("#stars .star").forEach(star => {
      const v = Number(star.dataset.val);
      star.classList.toggle("filled", v <= val);
    });
  }

  document.querySelectorAll("#stars .star").forEach(star => {
    star.addEventListener("click", () => {
      updateStars(Number(star.dataset.val));
    });
  });

  // ===== צ'יפים של מאפיינים =====
  document.querySelectorAll(".trait-chip").forEach(chip => {
    chip.addEventListener("click", () => {
      chip.classList.toggle("active");
    });
  });

  // ===== ולידציה =====
  function normalizePhone(p) {
    return (p || "").replace(/\D/g, "");
  }

  function isValidPhone(p) {
    const digits = normalizePhone(p);
    return digits.length === 9 || digits.length === 10;
  }

  function isValidEmail(e) {
    if (!e) return true; // מייל לא חובה, אבל אם יש – שיהיה תקין
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(e);
  }

  function clearErrors() {
    ["center","agent","phone","email"].forEach(id => {
      E(id).classList.remove("error");
    });
    E("msgErr").style.display = "none";
    E("msgOk").style.display  = "none";
  }

  // ===== שמירה מקומית (כרגע) =====
  function saveRecord() {
    clearErrors();

    const center = E("center").value.trim();
    const agent  = E("agent").value.trim();
    const date   = E("date").value;

    const name   = E("name").value.trim();
    const year   = E("year").value;
    const city   = E("city").value.trim();
    const phone  = E("phone").value.trim();
    const email  = E("email").value.trim();
    const field  = E("field").value;
    const impression = E("impression").value.trim();
    const notes      = E("notes").value.trim();

    const traits = Array.from(document.querySelectorAll(".trait-chip.active"))
      .map(ch => ch.dataset.t);

    // בדיקות חובה בסיסיות
    const errors = [];

    if (!center) {
      errors.push("יש לבחור מוקד.");
      E("center").classList.add("error");
    }
    if (!agent) {
      errors.push("יש למלא שם נציג.");
      E("agent").classList.add("error");
    }

    if (phone && !isValidPhone(phone)) {
      errors.push("מספר הטלפון אינו בפורמט תקין.");
      E("phone").classList.add("error");
    }

    if (!isValidEmail(email)) {
      errors.push("כתובת המייל אינה בפורמט תקין.");
      E("email").classList.add("error");
    }

    if (errors.length) {
      E("msgErr").textContent = errors.join(" ");
      E("msgErr").style.display = "block";
      return;
    }

    const rec = {
      center, agent, date,
      name, year, city, phone, email, field,
      rating: currentRating,
      traits, impression, notes
    };

    // כרגע – שמירה מקומית בלבד (אפשר להחליף בקריאה ל-API_URL)
    const key = "lfp_local_records";
    const existing = JSON.parse(localStorage.getItem(key) || "[]");
    existing.push(rec);
    localStorage.setItem(key, JSON.stringify(existing));

    E("msgOk").style.display = "block";
    console.log("Record saved locally:", rec);
    clearForm(false);
  }

  function clearForm(resetCenterAndAgent = true) {
    if (resetCenterAndAgent) {
      E("center").value = "";
      E("agent").value  = "";
      E("date").value   = "";
    }
    ["name","year","city","phone","email","field","impression","notes"].forEach(id => {
      E(id).value = "";
    });
    document.querySelectorAll(".trait-chip").forEach(chip => chip.classList.remove("active"));
    updateStars(0);
    clearErrors();
  }

  // ===== חיבור אירועים =====
  E("agent").addEventListener("change", autoFillByAgent);
  E("agent").addEventListener("blur", autoFillByAgent);

  E("btnSave").addEventListener("click", saveRecord);
  E("btnClear").addEventListener("click", () => clearForm(true));

</script>
</body>
</html>
